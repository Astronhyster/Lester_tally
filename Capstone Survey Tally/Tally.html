<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thesis Survey Tally</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .glow-shadow {
            box-shadow: 0 0 10px #60a5fa,
                0 0 20px #60a5fa,
                0 0 30px #60a5fa;
        }

        .dark-gradient {
            background: radial-gradient(circle at top left, #1f2937, #111827);
        }

        /* Modal specific styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .modal-content {
            background-color: #1f2937;
            margin: 15% auto;
            padding: 24px;
            border-radius: 8px;
            border: 1px solid #374151;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 400px;
            text-align: center;
        }

        canvas {
            background-color: #1f2937;
            border-radius: 8px;
            border: 1px solid #374151;
        }

        /* Print-specific styles */
        @media print {
            body {
                background-color: #fff;
                color: #000;
            }

            .dark-gradient {
                background: none;
            }

            h1,
            h2,
            h3,
            h4,
            th,
            td {
                color: #000 !important;
            }

            .input-section,
            .print-btn-container {
                display: none;
            }

            .glow-shadow,
            .dark-gradient,
            .bg-gray-800,
            .bg-gray-900,
            .bg-gray-700,
            .border-gray-700 {
                box-shadow: none;
                background-color: transparent;
                border: none;
            }

            canvas {
                border: 1px solid #000;
                background-color: #fff;
            }

            .modal {
                display: none !important;
            }

            .result-column,
            .crosstab-column {
                break-inside: avoid;
            }

            table {
                width: 100%;
            }

            th,
            td {
                padding: 4px;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-200 p-4 sm:p-8">

    <div class="max-w-7xl mx-auto dark-gradient rounded-3xl p-6 sm:p-10 border border-gray-700">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-center mb-6 sm:mb-10 text-white">Thesis Survey Tally
        </h1>

        <div class="input-section bg-gray-800 p-6 rounded-2xl shadow-xl mb-8 border border-gray-700">
            <h2 class="text-xl sm:text-2xl font-semibold mb-4 text-center">Data Input</h2>

            <div class="mb-6">
                <h3 class="text-lg font-medium mb-4 text-center">Select Question:</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4" id="questionSelector">
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-medium mb-2 text-center">Select Respondent Type:</h3>
                <div class="flex flex-wrap justify-center gap-2 sm:gap-4">
                    <button
                        class="type-btn bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-200"
                        data-type="Staff">Staff</button>
                    <button
                        class="type-btn bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-200"
                        data-type="Admin">Admin</button>
                    <button
                        class="type-btn bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 px-4 rounded-full transition-colors duration-200"
                        data-type="Customer">Customer</button>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-lg font-medium mb-2 text-center">Select Score (1-5):</h3>
                <div class="flex flex-wrap justify-center gap-2 sm:gap-4">
                    <button
                        class="score-btn bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200"
                        data-score="1">1</button>
                    <button
                        class="score-btn bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200"
                        data-score="2">2</button>
                    <button
                        class="score-btn bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200"
                        data-score="3">3</button>
                    <button
                        class="score-btn bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200"
                        data-score="4">4</button>
                    <button
                        class="score-btn bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200"
                        data-score="5">5</button>
                </div>
            </div>

            <div id="error" class="text-red-400 text-center mb-4"></div>
            <div class="flex justify-center">
                <button
                    class="clear-btn bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-full transition-colors duration-200"
                    id="clearDataBtn">Clear All Data</button>
            </div>
        </div>

        <div class="print-btn-container flex justify-center mb-8">
            <button id="printPdfBtn"
                class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-6 rounded-full transition-colors duration-200">
                Print as PDF
            </button>
        </div>


        <h2 class="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8 text-white">Respondent-wise Summary</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="result-column bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Staff</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Question</th>
                                <th class="p-2 text-gray-400">Total Responses</th>
                                <th class="p-2 text-gray-400">Mean Score</th>
                            </tr>
                        </thead>
                        <tbody id="staffResults"></tbody>
                    </table>
                </div>
            </div>
            <div class="result-column bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Admin</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Question</th>
                                <th class="p-2 text-gray-400">Total Responses</th>
                                <th class="p-2 text-gray-400">Mean Score</th>
                            </tr>
                        </thead>
                        <tbody id="adminResults"></tbody>
                    </table>
                </div>
            </div>
            <div class="result-column bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Customer</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Question</th>
                                <th class="p-2 text-gray-400">Total Responses</th>
                                <th class="p-2 text-gray-400">Mean Score</th>
                            </tr>
                        </thead>
                        <tbody id="customerResults"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <h2 class="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8 text-white">Crosstabulation</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="crosstab-column bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Staff Responses</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Question</th>
                                <th class="p-2 text-gray-400">Score 1</th>
                                <th class="p-2 text-gray-400">Score 2</th>
                                <th class="p-2 text-gray-400">Score 3</th>
                                <th class="p-2 text-gray-400">Score 4</th>
                                <th class="p-2 text-gray-400">Score 5</th>
                                <th class="p-2 text-gray-400">Total</th>
                            </tr>
                        </thead>
                        <tbody id="staffCrosstab"></tbody>
                    </table>
                </div>
            </div>
            <div class="crosstab-column bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Admin Responses</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Question</th>
                                <th class="p-2 text-gray-400">Score 1</th>
                                <th class="p-2 text-gray-400">Score 2</th>
                                <th class="p-2 text-gray-400">Score 3</th>
                                <th class="p-2 text-gray-400">Score 4</th>
                                <th class="p-2 text-gray-400">Score 5</th>
                                <th class="p-2 text-gray-400">Total</th>
                            </tr>
                        </thead>
                        <tbody id="adminCrosstab"></tbody>
                    </table>
                </div>
            </div>
            <div class="crosstab-column bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Customer Responses</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Question</th>
                                <th class="p-2 text-gray-400">Score 1</th>
                                <th class="p-2 text-gray-400">Score 2</th>
                                <th class="p-2 text-gray-400">Score 3</th>
                                <th class="p-2 text-gray-400">Score 4</th>
                                <th class="p-2 text-gray-400">Score 5</th>
                                <th class="p-2 text-gray-400">Total</th>
                            </tr>
                        </thead>
                        <tbody id="customerCrosstab"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="text-center text-sm text-gray-400 italic mb-8">
            <p><strong>Mean Score Formula:</strong> Mean = (Sum of all scores for a question or variable and respondent
                type) / (Total number of responses for that question or variable and respondent type)</p>
            <p>Example: If Staff responses for Question 1.1 are [3, 4, 5], then Mean = (3 + 4 + 5) / 3 = 4.00</p>
        </div>

        <h2 class="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8 text-white">Variable Summary</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Staff Variable Summary</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Variable</th>
                                <th class="p-2 text-gray-400">Total Responses</th>
                                <th class="p-2 text-gray-400">Average Score</th>
                            </tr>
                        </thead>
                        <tbody id="staffVariableSummary"></tbody>
                    </table>
                </div>
            </div>
            <div class="bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Admin Variable Summary</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Variable</th>
                                <th class="p-2 text-gray-400">Total Responses</th>
                                <th class="p-2 text-gray-400">Average Score</th>
                            </tr>
                        </thead>
                        <tbody id="adminVariableSummary"></tbody>
                    </table>
                </div>
            </div>
            <div class="bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700">
                <h3 class="text-xl font-semibold mb-4 text-center">Customer Variable Summary</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Variable</th>
                                <th class="p-2 text-gray-400">Total Responses</th>
                                <th class="p-2 text-gray-400">Average Score</th>
                            </tr>
                        </thead>
                        <tbody id="customerVariableSummary"></tbody>
                    </table>
                </div>
            </div>
            <div class="bg-gray-800 p-6 rounded-2xl shadow-xl border border-gray-700 col-span-1 lg:col-span-2">
                <h3 class="text-xl font-semibold mb-4 text-center">Total Mean Across All Respondent Types</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-700">
                            <tr>
                                <th class="p-2 text-left text-gray-400">Variable</th>
                                <th class="p-2 text-gray-400">Total Responses</th>
                                <th class="p-2 text-gray-400">Total Mean</th>
                            </tr>
                        </thead>
                        <tbody id="totalVariableSummary"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="clearDataModal" class="modal">
        <div class="modal-content">
            <p class="text-white text-lg mb-4">Are you sure you want to clear all responses?</p>
            <button id="modalYes"
                class="bg-green-500 hover:bg-green-400 text-white font-bold py-2 px-6 rounded-full transition-colors duration-200">Yes</button>
            <button id="modalNo"
                class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-full transition-colors duration-200">No</button>
        </div>
    </div>

    <script>
        // Questions list
        const questions = {
            'Functional Suitability': {
                '1.1': 'Provides different functions based on user role',
                '1.2': 'Enables complete booking process',
                '1.3': 'Allows customers to view history, update info, cancel',
                '1.4': 'Facilitates task accomplishment',
                '1.5': 'Enables staff to print receipts via QR code'
            },
            'Performance Efficiency': {
                '2.1': 'Pages load within acceptable time',
                '2.2': 'Handles multiple users without slowing',
                '2.3': 'Instant on-screen confirmation',
                '2.4': 'Smooth navigation with minimal delays',
                '2.5': 'Displays real-time availability and pricing'
            },
            'Compatibility': {
                '3.1': 'Works on major browsers',
                '3.2': 'Seamless payment gateway integration',
                '3.3': 'Integrated maps load correctly',
                '3.4': 'Sends email confirmations, manages on-site bookings',
                '3.5': 'Runs smoothly on mobile devices'
            },
            'Usability': {
                '4.1': 'Intuitive layout',
                '4.2': 'Provides necessary booking information',
                '4.3': 'Easy to learn without manual',
                '4.4': 'Protects against user errors',
                '4.5': 'Clear instructions for booking/payment'
            },
            'Reliability': {
                '5.1': 'Available 24/7',
                '5.2': 'Saves reservations correctly',
                '5.3': 'Consistent access to booking history',
                '5.4': 'No crashes or unexpected logouts',
                '5.5': 'Retains form data on errors'
            },
            'Security': {
                '6.1': 'Securely handles personal/payment data',
                '6.2': 'Restricts access to own data',
                '6.3': 'Ends session on logout',
                '6.4': 'Sends email notifications for account activity',
                '6.5': 'Secure "Forgot Password" process'
            },
            'Maintainability': {
                '7.1': 'Assets usable in multiple forms',
                '7.2': 'Restricts account access to specific users',
                '7.3': 'Allows customers to manage reservations',
                '7.4': 'Displays correct availability/pricing',
                '7.5': 'Correctly applies discounts/promotions'
            },
            'Portability': {
                '8.1': 'Works on desktop and mobile',
                '8.2': 'Adjusts to different screen sizes',
                '8.3': 'Allows cross-device booking completion',
                '8.4': 'All features functional across devices',
                '8.5': 'Responsive on slow connections'
            }
        };

        // Generate question keys (1.1 to 8.5)
        const questionKeys = Object.keys(questions).flatMap(category =>
            Object.keys(questions[category]).map(q => q)
        );

        // Map categories to their question prefixes
        const categoryPrefixes = {
            'Functional Suitability': ['1.1', '1.2', '1.3', '1.4', '1.5'],
            'Performance Efficiency': ['2.1', '2.2', '2.3', '2.4', '2.5'],
            'Compatibility': ['3.1', '3.2', '3.3', '3.4', '3.5'],
            'Usability': ['4.1', '4.2', '4.3', '4.4', '4.5'],
            'Reliability': ['5.1', '5.2', '5.3', '5.4', '5.5'],
            'Security': ['6.1', '6.2', '6.3', '6.4', '6.5'],
            'Maintainability': ['7.1', '7.2', '7.3', '7.4', '7.5'],
            'Portability': ['8.1', '8.2', '8.3', '8.4', '8.5']
        };

        // Load responses from local storage or initialize empty object
        let responses = JSON.parse(localStorage.getItem('surveyResponses')) || {
            Staff: Object.fromEntries(questionKeys.map(q => [q, []])),
            Admin: Object.fromEntries(questionKeys.map(q => [q, []])),
            Customer: Object.fromEntries(questionKeys.map(q => [q, []]))
        };
        let selectedType = null;
        let selectedQuestion = null;

        // Function to reset all data
        function clearAllData() {
            responses = {
                Staff: Object.fromEntries(questionKeys.map(q => [q, []])),
                Admin: Object.fromEntries(questionKeys.map(q => [q, []])),
                Customer: Object.fromEntries(questionKeys.map(q => [q, []]))
            };
            localStorage.removeItem('surveyResponses');
            selectedType = null;
            selectedQuestion = null;
            document.querySelectorAll('.question-btn').forEach(btn => btn.classList.remove('selected', 'glow-shadow'));
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('selected', 'glow-shadow'));
            document.getElementById('error').textContent = '';
            updateResults();
            document.getElementById('clearDataModal').style.display = 'none';
        }

        // Function to show the clear data modal
        function showClearDataModal() {
            document.getElementById('clearDataModal').style.display = 'block';
        }

        // Function to hide the clear data modal
        function hideClearDataModal() {
            document.getElementById('clearDataModal').style.display = 'none';
        }

        // Function to draw the tally chart on the canvas
        function drawTallyChart() {
            const canvas = document.getElementById('tallyChart');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas

            const scores = [1, 2, 3, 4, 5];
            const counts = [0, 0, 0, 0, 0];

            if (selectedQuestion && selectedType) {
                const currentScores = responses[selectedType][selectedQuestion];
                currentScores.forEach(score => {
                    if (score >= 1 && score <= 5) {
                        counts[score - 1]++;
                    }
                });
            }

            const xOffset = 50; // Padding from the left
            const yOffset = 50; // Padding from the top
            const lineHeight = 40;
            const lineSpacing = 10;
            const groupSpacing = 60;
            const tallyMarkLength = 30;

            // Draw tally marks for each score
            scores.forEach((score, index) => {
                const count = counts[index];
                const startX = xOffset + index * (5 * lineSpacing + groupSpacing);
                const startY = yOffset;

                // Draw the tally marks in groups of 5
                for (let i = 0; i < count; i++) {
                    const groupIndex = Math.floor(i / 5);
                    const markIndex = i % 5;

                    let currentX = startX + groupIndex * (lineSpacing * 4);
                    let currentY = startY;

                    ctx.strokeStyle = '#22c55e';
                    ctx.lineWidth = 4;
                    ctx.beginPath();

                    if (markIndex < 4) {
                        // Draw a vertical line
                        ctx.moveTo(currentX + markIndex * lineSpacing, currentY);
                        ctx.lineTo(currentX + markIndex * lineSpacing, currentY + tallyMarkLength);
                    } else {
                        // Draw the diagonal slash for the 5th mark
                        ctx.moveTo(currentX, currentY + tallyMarkLength);
                        ctx.lineTo(currentX + lineSpacing * 3.5, currentY);
                    }
                    ctx.stroke();
                }

                // Draw score labels
                ctx.fillStyle = '#9ca3af';
                ctx.font = '24px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(score, startX + 5 * lineSpacing + (groupSpacing / 2) - 30, startY + lineHeight + 10);
            });

            // Draw a line under the tallies for aesthetic purposes
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(xOffset, yOffset + lineHeight + 30);
            ctx.lineTo(canvas.width - xOffset, yOffset + lineHeight + 30);
            ctx.stroke();
        }

        // Populate question selector
        const questionSelector = document.getElementById('questionSelector');
        Object.keys(questions).forEach(category => {
            const column = document.createElement('div');
            column.className = 'flex flex-col gap-2 p-4 rounded-xl bg-gray-900 border border-gray-700';
            column.innerHTML = `<h4 class="font-semibold text-center text-blue-300">${category}</h4>`;
            Object.entries(questions[category]).forEach(([q, text]) => {
                const btn = document.createElement('button');
                btn.className = 'question-btn text-left p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors duration-200 text-xs sm:text-sm';
                btn.dataset.question = q;
                btn.textContent = `${q}: ${text}`;
                column.appendChild(btn);
            });
            questionSelector.appendChild(column);
        });

        // Function to update results display
        function updateResults() {
            const respondentTypes = ['Staff', 'Admin', 'Customer'];

            // Update summary tables
            respondentTypes.forEach(type => {
                const tbody = document.getElementById(`${type.toLowerCase()}Results`);
                tbody.innerHTML = '';
                Object.keys(questions).forEach(category => {
                    Object.entries(questions[category]).forEach(([q, text]) => {
                        const scores = responses[type][q];
                        const total = scores.length;
                        // Calculate mean score for each question
                        const mean = total > 0
                            ? (scores.reduce((sum, val) => sum + val, 0) / total).toFixed(2)
                            : '0.00';
                        const row = document.createElement('tr');
                        row.className = 'border-b border-gray-700 last:border-0 hover:bg-gray-700';
                        row.innerHTML = `
                            <td class="p-2 text-left text-xs">${q}: ${text}</td>
                            <td class="p-2 text-center">${total}</td>
                            <td class="p-2 text-center">${mean}</td>
                        `;
                        tbody.appendChild(row);
                    });
                });
            });

            // Update crosstabulation tables
            respondentTypes.forEach(type => {
                const crosstabTbody = document.getElementById(`${type.toLowerCase()}Crosstab`);
                crosstabTbody.innerHTML = '';
                Object.keys(questions).forEach(category => {
                    Object.entries(questions[category]).forEach(([q, text]) => {
                        const scores = responses[type][q];
                        const scoreCounts = Array(5).fill(0);
                        scores.forEach(score => {
                            if (score >= 1 && score <= 5) {
                                scoreCounts[score - 1]++;
                            }
                        });
                        const total = scores.length;
                        const row = document.createElement('tr');
                        row.className = 'border-b border-gray-700 last:border-0 hover:bg-gray-700';
                        row.innerHTML = `
                            <td class="p-2 text-left text-xs">${q}: ${text}</td>
                            <td class="p-2 text-center">${scoreCounts[0]}</td>
                            <td class="p-2 text-center">${scoreCounts[1]}</td>
                            <td class="p-2 text-center">${scoreCounts[2]}</td>
                            <td class="p-2 text-center">${scoreCounts[3]}</td>
                            <td class="p-2 text-center">${scoreCounts[4]}</td>
                            <td class="p-2 text-center">${total}</td>
                        `;
                        crosstabTbody.appendChild(row);
                    });
                });
            });

            // Update variable summary tables for each respondent type
            respondentTypes.forEach(type => {
                const variableTbody = document.getElementById(`${type.toLowerCase()}VariableSummary`);
                variableTbody.innerHTML = '';
                Object.keys(categoryPrefixes).forEach(category => {
                    let totalResponses = 0;
                    let totalScore = 0;
                    const questionKeys = categoryPrefixes[category];
                    questionKeys.forEach(q => {
                        const scores = responses[type][q];
                        totalResponses += scores.length;
                        totalScore += scores.reduce((sum, val) => sum + val, 0);
                    });
                    const mean = totalResponses > 0
                        ? (totalScore / totalResponses).toFixed(2)
                        : '0.00';
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-700 last:border-0 hover:bg-gray-700';
                    row.innerHTML = `
                        <td class="p-2 text-left">${category}</td>
                        <td class="p-2 text-center">${totalResponses}</td>
                        <td class="p-2 text-center">${mean}</td>
                    `;
                    variableTbody.appendChild(row);
                });
            });

            // Update total mean table across all respondent types
            const totalVariableTbody = document.getElementById('totalVariableSummary');
            totalVariableTbody.innerHTML = '';
            Object.keys(categoryPrefixes).forEach(category => {
                let totalResponses = 0;
                let totalScore = 0;
                const questionKeys = categoryPrefixes[category];
                respondentTypes.forEach(type => {
                    questionKeys.forEach(q => {
                        const scores = responses[type][q];
                        totalResponses += scores.length;
                        totalScore += scores.reduce((sum, val) => sum + val, 0);
                    });
                });
                const mean = totalResponses > 0
                    ? (totalScore / totalResponses).toFixed(2)
                    : '0.00';
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 last:border-0 hover:bg-gray-700';
                row.innerHTML = `
                    <td class="p-2 text-left">${category}</td>
                    <td class="p-2 text-center">${totalResponses}</td>
                    <td class="p-2 text-center">${mean}</td>
                `;
                totalVariableTbody.appendChild(row);
            });

            // Call the tally chart function to draw or update the chart
            drawTallyChart();
        }

        // Function to save responses to local storage
        function saveResponses() {
            localStorage.setItem('surveyResponses', JSON.stringify(responses));
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Handle question selection
            document.querySelectorAll('.question-btn').forEach(button => {
                button.addEventListener('click', function () {
                    selectedQuestion = this.dataset.question;
                    document.querySelectorAll('.question-btn').forEach(btn => btn.classList.remove('selected', 'glow-shadow'));
                    this.classList.add('selected', 'glow-shadow');
                    document.getElementById('error').textContent = '';
                    drawTallyChart(); // Update chart on question selection
                });
            });

            // Handle respondent type selection
            document.querySelectorAll('.type-btn').forEach(button => {
                button.addEventListener('click', function () {
                    selectedType = this.dataset.type;
                    document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('selected', 'glow-shadow'));
                    this.classList.add('selected', 'glow-shadow');
                    document.getElementById('error').textContent = '';
                    drawTallyChart(); // Update chart on type selection
                });
            });

            // Handle score selection
            document.querySelectorAll('.score-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const errorDiv = document.getElementById('error');
                    if (!selectedQuestion) {
                        errorDiv.textContent = 'Please select a question first.';
                        return;
                    }
                    if (!selectedType) {
                        errorDiv.textContent = 'Please select a respondent type first.';
                        return;
                    }

                    const score = parseInt(this.dataset.score);
                    responses[selectedType][selectedQuestion].push(score);
                    saveResponses();
                    updateResults();
                    errorDiv.textContent = '';
                });
            });

            // Handle clear data button
            document.getElementById('clearDataBtn').addEventListener('click', showClearDataModal);
            document.getElementById('modalYes').addEventListener('click', clearAllData);
            document.getElementById('modalNo').addEventListener('click', hideClearDataModal);

            // Handle print button
            document.getElementById('printPdfBtn').addEventListener('click', () => {
                window.print();
            });

            // Initialize results and chart on page load
            updateResults();
            drawTallyChart();
        });
    </script>
</body>

</html>
